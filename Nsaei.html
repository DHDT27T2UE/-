<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>متجر توشن للأناقة</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@700&display=swap" rel="stylesheet">
  <style>
    :root {
      --main-bg: #444444;
      --card-bg: #000;
      --purple: #9313FF;
      --purple-dark: #8a62d6;
      --gray: #23233a;
      --gray2: #222;
      --text: #eee;
      --text2: #bbb;
      --border: #23233a;
    }
    body {
      background: var(--main-bg);
      color: var(--text);
      font-family: 'Cairo', Arial, sans-serif;
      margin: 0;
      padding: 0;
      min-height: 100vh;
    }
    /* الشريط العلوي */
    .navbar {
      background: #9313FF;
      color: var(--purple);
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 12px;
      height: 56px;
      box-shadow: 0 2px 8px #0005;
      position: fixed;
      top: 0; right: 0; left: 0;
      z-index: 20;
      font-size: 16px;
    }
    .navbar-title {
      font-size: 1.50rem;
      font-weight: 700;
      color: white ;
      flex: 1;
      text-align: center;
      letter-spacing: 0.3px;
      padding: 0 7px;
      user-select: none;
    }
    .navbar-actions {
      display: flex;
      align-items: center;
      gap: 10px;
      min-width: 20px;
    }
    .navbar-icon-btn {
      background: none;
      border: none;
      cursor: pointer;
      padding: 4px;
      margin: 0;
      outline: none;
      position: relative;
      width: 44px;
      height: 44px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .navbar-icon-btn img {
      width: 38px; height: 38px;
      filter: brightness(0.97);
      vertical-align: middle;
      display: block;
    }
    /* زر القائمة خطوط بيضاء */
    .menu-lines {
      display: inline-block;
      width: 20px;
      height: 20px;
      position: relative;
    }
    .menu-lines span {
      background: #fff;
      display: block;
      height: 2px;
      border-radius: 2px;
      margin: 5px 0;
      transition: 0.25s;
    }
    .menu-lines span:not(:first-child) {
      margin-top: 0;
    }
    .menu-lines span {
      width: 90%;
    }
    /* أماكن الأزرار */
    .navbar-right { order: 2; }
    .navbar-left { order: 2; }
    .navbar-title { order: 1; }
    /* القائمة الجانبية */
    .sidemenu-backdrop {
      display: none;
      position: fixed; top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(30,24,50,0.28); z-index: 30;
    }
    .sidemenu {
      position: fixed;
      top: 0; right: 0; bottom: 0;
      width: 220px;
      background: var(--card-bg);
      color: #fff;
      transform: translateX(100%);
      transition: transform 0.25s;
      z-index: 31;
      box-shadow: -2px 0 12px #0006;
      padding-top: 17px;
      border-left: 2.5px solid var(--purple);
      direction: rtl;
      font-size: 1.11rem;
    }
    .sidemenu.open { transform: translateX(0);}
    .sidemenu-close-btn {
      font-size: 2rem;
      color: var(--purple);
      background: none;
      border: none;
      position: absolute;
      top: 6px; right: 10px;
      cursor: pointer;
    }
    .sidemenu a {
      display: block;
      color: #eee;
      text-decoration: none;
      padding: 11px 30px 11px 10px;
      font-size: 1.09rem;
      border-bottom: 1px solid var(--gray);
      transition: background 0.18s;
      text-align: right;
    }
    .sidemenu a:hover { background: var(--gray); color: var(--purple);}
    /* شبكة المنتجات */
    .products-grid {
      margin-top: 70px;
      display: grid;
      grid-template-columns: repeat(2,1fr);
      gap: 20px 12px;
      width: min(99vw, 80px);
      margin-inline: auto;
      margin-bottom: 35px;
      justify-content: center;
    }
    @media (max-width:600px) {
      .products-grid { grid-template-columns: 1fr 1fr; width: 99vw;}
    
.products-grid {
  margin-top: 70px;
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 13px 3px;
  width: min(99vw, 400px);
  margin-inline: auto;
  margin-bottom: 35px;
  justify-content: center;
}
/* أبقي هذا الميديا فقط لو تريد تصغير الأعمدة في الشاشات الصغيرة جدًا */
@media (max-width: 350px) {
  .products-grid { grid-template-columns: 1fr; }
}
    .product-card {
      background: var(--card-bg);
      border-radius: 11px;
      box-shadow: 0 2px 16px #0007;
      padding: 4.5px 4px 10px 4px;
      text-align: center;
      display: flex;
      flex-direction: column;
      gap: 8px;
      position: relative;
      min-width: 0;
      border: 1.5px solid var(--border);
      max-width: 200px;
      margin-inline: auto;
    }
    .product-card img.main-img {
      width: 186px; height: 258px; object-fit: cover;
      border-radius: 8px;
      margin-bottom: 7px;
      background: var(--gray);
      box-shadow: 0 1px 10px #b085f52c;
    }
    .product-card .product-title {
      color: white ;
      font-size: 1.09rem;
      font-weight: bold;
      margin: 0 0 3px;
      letter-spacing: 0.2px;
    }
    .product-card .product-desc {
      font-size: 0.65rem;
      color: ;
      margin-bottom: 1px;
      min-height: 10px;
    }
    .product-card .product-prices {
      margin-bottom: 0;
      font-size: 0.98rem;
    }
    .product-card .old-price {
      text-decoration: line-through;
      color: #444;
      margin-left: 16px;
      font-size: 0.86rem;
    }
    .product-card .new-price {
      color: white ;
      font-size: 1.07rem;
      font-weight: bold;
    }
    .product-actions {
      display: flex;
      justify-content: center;
      gap: 7px;
      margin-top: 2px;
    }
    .buy-now-btn {
      background: var(--purple);
      color: #fff;
      border: none;
      padding: 1px 35px 1px 35px;
      border-radius: 7px;
      font-size: 0.73rem;
      cursor: pointer;
      font-family: 'Cairo', Arial;
      font-weight: 700;
      transition: background 0.18s;
      border: 1px solid #b085f580;
    }
    .buy-now2-btn {
      background: var(--purple);
      color: #fff;
      border: none;
      padding: 6px 130px 6px 130px;
      border-radius: 7px;
      font-size: 0.85rem;
      cursor: pointer;
      font-family: 'Cairo', Arial;
      font-weight: 900;
      transition: background 0.18s;
      border: 1px solid #b085f580;
    }
    .buy-now-btn:hover { background: var(--purple-dark);}
    .add-cart-btn {
      background: none;
      border: none;
      cursor: pointer;
      display: flex;
      align-items: center;
      padding: 0 0 0 3px;
    }
    .add-cart-btn img {
      width: 27px; height: 27px;
      filter: drop-shadow(0 1px 2px #b085f533);
    }
    /* النوافذ المنبثقة */
    .modal-backdrop {
      display: none;
      position: fixed; inset: 0;
      background: rgba(00,00,00,0.50);
      z-index: 50;
    }
    .modal {
      display: none;
      position: fixed;
      top: 50%; left: 50%;
      transform: translate(-50%,-50%);
      background: #222222 ;
      color: #fff;
      border-radius: 13px;
      max-width: 98vw;
      width: 360px;
      box-shadow: 0 10px 40px #000e;
      z-index: 51;
      padding: 0 0 10px 0;
      animation: popup 0.38s;
      font-size: 1.04rem;
    }
    @keyframes popup { 0%{scale:0.8; opacity:0;} 100%{scale:1; opacity:1;} }
    .modal-header {
      padding: 8px 18px 0 18px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: p.13rem;
    }
    .modal-close-btn {
      background: none;
      border: none;
      color: white;
      font-size: 1.5rem;
      cursor: pointer;
      margin-left: 1px;
    }
    .modal-title {
      font-size: 1.10rem;
      font-weight: bold;
      color: var(--purple);
    }
    .modal-body {
      padding: 9px 18px 0 18px;
    }
    /* معرض صور المنتج */
    .product-gallery {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      margin: 6px 0 11px 0;
    }
    .gallery-arrow {
      background: none;
      border: none;
      color: var(--purple);
      font-size: 2.25rem;
      cursor: pointer;
      padding: 0 4px;
    }
    .gallery-image {
      width: 340px; height: 320px;
      object-fit: cover;
      border-radius: 8px;
      background: var(--gray);
    }
    /* نموذج الطلب */
   .order-form label {
  font-size: 0.8rem;
  display: block;
  margin: 7px 0 2px 0;
  color: white;
  font-weight: 100 ;
  font-family: 'Cairo', sans-serif;
}
    .order-form input, .order-form select, .order-form textarea {
      width: 100%;
      padding: 7px 5px 7px 0.50px;
      border-radius: 6px;
      border: 1px solid var(--gray);
      background: #313131;
      color: #ffffff63 ;
      font-size: 0.7rem;
      margin-bottom: 6px;
      font-family: 'Cairo', Arial, sans-serif;
      resize: none;
    }
    .order-form textarea { min-height: 34px;}
    .order-form .gps-btn {
      background: var(--gray);
      color: var(--purple);
      border: 1px solid var(--purple);
      font-size: 0.93rem;
      border-radius: 6px;
      padding: 5px 14px;
      margin-bottom: 8px;
      cursor: pointer;
      float: left;
    }
    .order-form .gps-btn:hover { background: #201a2d;}
    .order-form .submit-btn {
      background: var(--purple);
      color: #fff;
      border: none;
      padding: 9px 0;
      border-radius: 8px;
      font-size: 1.07rem;
      font-weight: bold;
      cursor: pointer;
      margin-top: 11px;
      width: 100%;
    }
    .order-form .submit-btn:hover { background: var(--purple-dark);}
    /* نافذة السلة */
    .cart-modal-list {
      max-height: 190px;
      overflow-y: auto;
      margin-bottom: 9px;
      direction: rtl;
    }
    .cart-item {
      display: flex;
      align-items: center;
      background: #181820;
      border-radius: 6px;
      margin-bottom: 7px;
      padding: 7px 7px 7px 4px;
      gap: 10px;
      box-shadow: 0 1px 3px #b085f511;
      font-size: 1.03rem;
    }
    .cart-item img {
      width: 44px; height: 58px; object-fit: cover;
      border-radius: 6px;
      background: var(--gray);
    }
    .cart-item-details {
      flex: 1;
      padding: 0 6px;
    }
    .cart-item-title {
      font-size: 1.03rem;
      color: var(--purple);
      font-weight: bold;
    }
    .cart-item-desc {
      color: #bbb;
      font-size: 0.60rem;
      margin-bottom: 0;
    }
    .cart-item-price {
      color: var(--purple);
      font-weight: bold;
      font-size: 1.01rem;
    }
    .cart-remove-btn {
      background: none;
      border: none;
      color: #e57373;
      font-size: 1.3rem;
      cursor: pointer;
      margin-right: 3px;
      padding: 0;
    }
    /* نافذة التأكيد */
    .confirm-modal-message {
      font-size: 1.04rem;
      color: var(--purple);
      margin: 13px 0 5px 0;
      text-align: center;
    }
    .confirm-modal-btn {
      background: var(--purple);
      color: #fff;
      border: none;
      padding: 8px 24px;
      border-radius: 8px;
      font-size: 1.05rem;
      font-weight: bold;
      cursor: pointer;
      display: block;
      margin: 0 auto 8px;
    }
    /* تمرير */
    ::-webkit-scrollbar {width:7px;background:#161624;}
    ::-webkit-scrollbar-thumb {background:#b085f552;border-radius:10px;}
    }
     .menu-icon {
      background: none;
      border: none;
      color: white;
      font-size: 20px;
      cursor: pointer;
    
  </style>
</head>
<body>
  <!-- الشريط العلوي -->
  <div class="navbar">
    <!-- زر السلة أقصى اليمين -->
    <div class="navbar-right navbar-actions">
      <button class="navbar-icon-btn" id="cart-btn" title="السلة">
        <img src="https://i.postimg.cc/zGxWb2Gg/image.png" alt="سلة المشتريات">
        <span id="cart-count" style="position:absolute;top:7px;left:7px;background:#b085f5;color:#fff;font-size:0.87rem;padding:1px 7px;border-radius:10px;display:none;"></span>
      </button>
    </div>
    <div class="navbar-title">متجر توشن للأناقة</div>
    <!-- زر القائمة الجانبية أقصى اليسار -->
    <div class="navbar-left navbar-actions">
      <!--<button class="navbar-icon-btn" id="menu-btn" title="القائمة"-->
        <!--span class="menu-lines"-->
          
            <button class="navbar-icon-btn" id="menu-btn" title="القائمة">
            <div class="menu-icon" onclick="toggleSidebar()">☰</div>
          <span></span>
          <span></span>
          <span></span>
        </span>
      </button>
    </div>
  </div>
  <!-- القائمة الجانبية -->
  <div class="sidemenu-backdrop" id="sidemenu-backdrop"></div>
  <nav class="sidemenu" id="sidemenu">
    <button class="sidemenu-close-btn" id="close-sidemenu">&times;</button>
    <a href="#" onclick="closeSidemenu()">الرئيسية</a>
    <a href="#" onclick="openCartModal();closeSidemenu()">السلة</a>
    <a href="#" onclick="alert('متجر عرب ستايل - أرقى المنتجات العربية.');closeSidemenu()">من نحن</a>
    <a href="mailto:arab.style.store@gmail.com" onclick="closeSidemenu()">تواصل معنا</a>
  </nav>
  <!-- شبكة المنتجات -->
  <main>
    <div class="products-grid" id="products-grid"></div>
  </main>
  <!-- نافذة تفاصيل المنتج -->
  <div class="modal-backdrop" id="product-modal-backdrop"></div>
  <div class="modal" id="product-modal">
    <div class="modal-header">
      <span class="modal-title" id="modal-product-title"></span>
      <button class="modal-close-btn" onclick="closeProductModal()">&times;</button>
    </div>
    <div class="modal-body">
      <div class="product-gallery" id="product-gallery"></div>
      <div id="modal-product-desc" style="margin:10px 0 6px 0; color:#ccc;font-size:1.07rem"></div>
      <div class="product-prices">
        <span class="old-price" id="modal-old-price"></span>
        <span class="new-price" id="modal-new-price"></span>
      </div>
      <button class="buy-now2-btn" id="modal-buy-btn" style="margin-top:5px;">شراء الآن</button>
    </div>
  </div>
  <!-- نافذة نموذج الطلب -->
  <div class="modal-backdrop" id="order-modal-backdrop"></div>
  <div class="modal" id="order-modal">
    <div class="modal-header">
      <span class="modal-title">طلب توصيل</span>
      <button class="modal-close-btn" onclick="closeOrderModal()">&times;</button>
    </div>
    <div class="modal-body">
      <div style="color:#b085f5;font-weight:bold;margin-bottom:7px;" id="order-product-name"></div>
     <form class="order-form" id="order-form">
  <label>الاسم الكامل</label>
  <input type="text" id="order-name" name="fullname" required autocomplete="name">

  <label>رقم الهاتف</label>
  <input type="tel" id="order-phone" name="phone" required pattern="^(\+?\d{9,15})$" placeholder="">

  <label>المحافظة</label>
  <select id="order-governorate" name="state" required>
    <option value="">اختيار المحافظة</option>
    <option>صنعاء</option>
    <option>عدن</option>
    <option>الضالع</option>
    <option>دمت</option>
  </select>

  <label>العنوان بالتفصيل</label>
  <input type="text" id="order-address" name="address" placeholder="مثال: شارع 25 شقة رقم 3" required>

  <label>طريقة الدفع</label>
  <select id="order-payment-method" name="payment" required>
    <option value="">اختيار طريقة الدفع</option>
    <option>الدفع عند الاستلام</option>
    <option>تحويل بنكي</option>
  </select>

  <label>ملاحظات إضافية</label>
  <input type="text" id="order-notes" name="note" placeholder="مثال: أريد التوصيل غداً ظهراً، لأني اليوم مشغول">

  <button type="button" class="gps-btn" onclick="getLocation()">تحديد الموقع الجغرافي</button>
  <input type="hidden" id="order-location" name="location">
  <div id="gps-status" style="font-size:0.97rem;color:#b085f5;"></div>

  <button type="submit" class="submit-btn">إرسال الطلب</button>
</form>
    </div>
  </div>
  <!-- نافذة تأكيد الطلب -->
  <div class="modal-backdrop" id="confirm-modal-backdrop"></div>
  <div class="modal" id="confirm-modal">
    <div class="modal-header">
      <span class="modal-title">تم إرسال الطلب</span>
      <button class="modal-close-btn" onclick="closeConfirmModal()">&times;</button>
    </div>
    <div class="modal-body">
      <div class="confirm-modal-message">
        تم إرسال الطلب بنجاح!<br>
        سيتم التواصل معك عبر الهاتف أو واتساب.<br>
        لأي استفسار: arab.style.store@gmail.com
      </div>
      <button class="confirm-modal-btn" onclick="closeConfirmModal()">حسناً</button>
    </div>
  </div>
  <!-- نافذة السلة -->
  <div class="modal-backdrop" id="cart-modal-backdrop"></div>
  <div class="modal" id="cart-modal">
    <div class="modal-header">
      <span class="modal-title">سلة المشتريات</span>
      <button class="modal-close-btn" onclick="closeCartModal()">&times;</button>
    </div>
    <div class="modal-body">
      <div class="cart-modal-list" id="cart-modal-list"></div>
    </div>
  </div>
  <!-- سكريبت الموقع -->
  <script>
    // بيانات المنتجات (4 منتجات مع صور)
    const products = [
      {
        id: 1,
        name: "عباية كلاسيكية فاخرة",
        desc: "عباية سوداء بتصميم عصري وأقمشة فاخرة.",
        priceOld: 299, priceNew: 199,
        images: [
          "https://i.postimg.cc/prDdq0jc/0005181.jpg",
          "https://i.postimg.cc/prDdq0jc/0005181.jpg",
          "https://i.postimg.cc/prDdq0jc/0005181.jpg",
          "https://i.postimg.cc/prDdq0jc/0005181.jpg",
          "https://i.postimg.cc/prDdq0jc/0005181.jpg"
        ]
      },
      {
        id: 2,
        name: "جلابية عربية مطرزة",
        desc: "جلابية مطرزة يدويًا بلمسة عربية.",
        priceOld: 199, priceNew: 129,
        images: [
          "https://i.postimg.cc/prDdq0jc/0005181.jpg",
          "https://i.postimg.cc/prDdq0jc/0005181.jpg",
          "https://i.postimg.cc/prDdq0jc/0005181.jpg",
          "https://i.postimg.cc/prDdq0jc/0005181.jpg",
          "https://i.postimg.cc/prDdq0jc/0005181.jpg"
        ]
      },
      {
        id: 3,
        name: "حقيبة يد جلدية أنيقة",
        desc: "حقيبة يد جلد طبيعي بتصميم عملي وفخم.",
        priceOld: 179, priceNew: 119,
        images: [
          "https://i.postimg.cc/FF6m9Qtp/image.jpg",
          "https://i.postimg.cc/prDdq0jc/0005181.jpg",
          "https://i.postimg.cc/prDdq0jc/0005181.jpg",
          "https://i.postimg.cc/FF6m9Qtp/image.jpg",
          "https://i.postimg.cc/prDdq0jc/0005181.jpg"
        ]
      },
      {
        id: 4,
        name: "شال صوف فاخر",
        desc: "شال صوف عصري وناعم لفصل الشتاء.",
        priceOld: 99, priceNew: 69,
        images: [
          "https://i.postimg.cc/prDdq0jc/0005181.jpg",
          "https://i.postimg.cc/prDdq0jc/0005181.jpg",
          "https://i.postimg.cc/prDdq0jc/0005181.jpg",
          "https://i.postimg.cc/prDdq0jc/0005181.jpg",
          "https://i.postimg.cc/prDdq0jc/0005181.jpg"
        ]
      }
    ];

    // ========== وظائف القائمة الجانبية ==========
    const sidemenu = document.getElementById('sidemenu');
    const sidemenuBackdrop = document.getElementById('sidemenu-backdrop');
    document.getElementById('menu-btn').onclick = () => {
      sidemenu.classList.add('open');
      sidemenuBackdrop.style.display = "block";
    };
    document.getElementById('close-sidemenu').onclick = closeSidemenu;
    sidemenuBackdrop.onclick = closeSidemenu;
    function closeSidemenu() {
      sidemenu.classList.remove('open');
      sidemenuBackdrop.style.display = "none";
    }

    // ========== عرض المنتجات ==========
    const productsGrid = document.getElementById('products-grid');
    function renderProducts() {
      productsGrid.innerHTML = '';
      products.forEach(p => {
        const div = document.createElement('div');
        div.className = 'product-card';
        div.innerHTML = `
          <img src="${p.images[0]}" class="main-img" alt="${p.name}">
          <div class="product-title">${p.name}</div>
          <div class="product-desc">${p.desc}</div>
          <div class="product-prices">
            <span class="old-price">${p.priceOld} ر.س</span>
            <span class="new-price">${p.priceNew} ر.س</span>
          </div>
          <div class="product-actions">
            <button class="buy-now-btn" onclick="openProductModal(${p.id})">تعرف أكثر</button>
            <button class="add-cart-btn" onclick="addToCart(${p.id})" title="أضف للسلة">
              <img src="https://i.postimg.cc/7PC6BTR2/image.png" alt="أضف للسلة">
            </button>
          </div>
        `;
        productsGrid.appendChild(div);
      });
    }
    renderProducts();

    // ========== نافذة تفاصيل المنتج ==========
    let currentProductId = null, currentGalleryIdx = 0;
    function openProductModal(pid) {
      const p = products.find(x => x.id === pid);
      if (!p) return;
      currentProductId = pid;
      currentGalleryIdx = 0;
      document.getElementById('modal-product-title').textContent = p.name;
      document.getElementById('modal-product-desc').textContent = p.desc;
      document.getElementById('modal-old-price').textContent = p.priceOld + " ر.س";
      document.getElementById('modal-new-price').textContent = p.priceNew + " ر.س";
      renderGallery(p.images, 0);
      document.getElementById('product-modal-backdrop').style.display = 'block';
      document.getElementById('product-modal').style.display = 'block';
    }
    function closeProductModal() {
      document.getElementById('product-modal-backdrop').style.display = 'none';
      document.getElementById('product-modal').style.display = 'none';
    }
    document.getElementById('product-modal-backdrop').onclick = closeProductModal;
    function renderGallery(images, idx) {
      const gallery = document.getElementById('product-gallery');
      gallery.innerHTML = `
        <button class="gallery-arrow" onclick="changeGallery(-1)">&lt;</button>
        <img src="${images[idx]}" class="gallery-image" alt="صورة المنتج">
        <button class="gallery-arrow" onclick="changeGallery(1)">&gt;</button>
      `;
    }
    window.changeGallery = function(dir){
      const p = products.find(x => x.id === currentProductId);
      if (!p) return;
      currentGalleryIdx = (currentGalleryIdx + dir + p.images.length) % p.images.length;
      renderGallery(p.images, currentGalleryIdx);
    }

    // ========== نافذة نموذج الطلب ==========
    let currentOrderProduct = null;
    document.getElementById('modal-buy-btn').onclick = function(){
      openOrderModal(currentProductId);
    };
    function openOrderModal(pid){
      const p = products.find(x => x.id === pid);
      if(!p) return;
      currentOrderProduct = p;
      document.getElementById('order-product-name').textContent = p.name;
      document.getElementById('order-form').reset();
      document.getElementById('gps-status').textContent = '';
      document.getElementById('order-modal-backdrop').style.display = 'block';
      document.getElementById('order-modal').style.display = 'block';
      closeProductModal();
    }
    function closeOrderModal(){
      document.getElementById('order-modal-backdrop').style.display = 'none';
      document.getElementById('order-modal').style.display = 'none';
    }
    document.getElementById('order-modal-backdrop').onclick = closeOrderModal;

    // ========== إرسال الطلب ==========
    document.getElementById('order-form').onsubmit = function(e){
  e.preventDefault();

  const name = document.getElementById('order-name').value;
  const phone = document.getElementById('order-phone').value;
  const governorate = document.getElementById('order-governorate').value;
  const address = document.getElementById('order-address').value;
  const paymentMethod = document.getElementById('order-payment-method').value;
  const notes = document.getElementById('order-notes').value || '';
  const location = document.getElementById('order-location').value;

  if (!location) {
    document.getElementById('gps-status').textContent = 'يجب تحديد الموقع الجغرافي أولاً.';
    return;
  }

  const payload = {
    name,
    phone,
    governorate,
    address,
    paymentMethod,
    notes,
    location
  };

  fetch('https://script.google.com/macros/s/AKfycbx6UQsh1r8X6UsYzBafQfiiD1d9eimEhL0Oc8qfyapt-3mXwulmIwoQ-0WfEyt8eB-L/exec', {
    method: 'POST',
    body: JSON.stringify(payload),
    headers: {
      'Content-Type': 'application/json'
    }
  })
  .then(res => res.text())
  .then(result => {
    closeOrderModal();
    openConfirmModal();
  })
  .catch(err => {
    alert("حدث خطأ أثناء إرسال الطلب. حاول مرة أخرى.");
    console.error(err);
  });
};

    // ========== نافذة تأكيد الطلب ==========
    function openConfirmModal(){
      document.getElementById('confirm-modal-backdrop').style.display = 'block';
      document.getElementById('confirm-modal').style.display = 'block';
    }
    function closeConfirmModal(){
      document.getElementById('confirm-modal-backdrop').style.display = 'none';
      document.getElementById('confirm-modal').style.display = 'none';
      window.scrollTo({top:0,behavior:'smooth'});
    }
    document.getElementById('confirm-modal-backdrop').onclick = closeConfirmModal;

    // ========== الموقع الجغرافي ==========
   function getLocation(){
  if (!navigator.geolocation){
    document.getElementById('gps-status').textContent = 'المتصفح لا يدعم تحديد الموقع.';
    return;
  }

  document.getElementById('gps-status').textContent = 'جاري تحديد الموقع...';

  navigator.geolocation.getCurrentPosition(
    pos => {
      const loc = pos.coords.latitude + ',' + pos.coords.longitude;
      document.getElementById('order-location').value = loc;
      document.getElementById('gps-status').textContent = 'تم تحديد الموقع بنجاح ✅';
    },
    err => {
      console.log(err);
      if (err.code === 1) {
        // تم رفض الصلاحية
        document.getElementById('gps-status').textContent = 'يرجى تفعيل صلاحية الوصول إلى الموقع من المتصفح.';
      } else if (err.code === 2 || err.code === 3) {
        // GPS غير مفعّل أو فشل في تحديد الموقع
        document.getElementById('gps-status').textContent = 'يرجى تشغيل الموقع (GPS) من إعدادات الهاتف ثم المحاولة مجددًا.';
      } else {
        document.getElementById('gps-status').textContent = 'تعذر تحديد الموقع. حاول مجددًا.';
      }
    },
    {
      enableHighAccuracy: true,
      timeout: 10000
    }
  );
}

    // ========== السلة ==========
    function getCart(){
      try{
        return JSON.parse(localStorage.getItem('arabstyle_cart')||'[]');
      }catch{ return [];}
    }
    function setCart(arr){
      localStorage.setItem('arabstyle_cart', JSON.stringify(arr));
      updateCartCount();
    }
    function addToCart(pid){
      const cart = getCart();
      const item = cart.find(x=>x.id===pid);
      if(item) item.qty++;
      else cart.push({id:pid,qty:1});
      setCart(cart);
      updateCartCount();
      showAddToCartEffect();
    }
    function removeFromCart(pid){
      let cart = getCart();
      cart = cart.filter(x=>x.id!==pid);
      setCart(cart);
      renderCartModal();
    }
    function updateCartCount(){
      const count = getCart().reduce((sum,x)=>sum+x.qty,0);
      const span = document.getElementById('cart-count');
      span.style.display = count? 'inline-block':'none';
      span.textContent = count || '';
    }
    updateCartCount();

    // ========== نافذة السلة ==========
    document.getElementById('cart-btn').onclick = openCartModal;
    document.getElementById('cart-modal-backdrop').onclick = closeCartModal;
    function openCartModal(){
      renderCartModal();
      document.getElementById('cart-modal-backdrop').style.display = 'block';
      document.getElementById('cart-modal').style.display = 'block';
    }
    function closeCartModal(){
      document.getElementById('cart-modal-backdrop').style.display = 'none';
      document.getElementById('cart-modal').style.display = 'none';
    }
    function renderCartModal(){
      const cart = getCart();
      const list = document.getElementById('cart-modal-list');
      if(cart.length===0){
        list.innerHTML = `<div style="text-align:center;color:#b085f5;padding:13px 0;font-size:1.09rem;">سلة المشتريات فارغة.</div>`;
        return;
      }
      list.innerHTML = '';
      cart.forEach(item=>{
        const prod = products.find(x=>x.id===item.id);
        if(!prod) return;
        const div = document.createElement('div');
        div.className = 'cart-item';
        div.innerHTML = `
          <img src="${prod.images[0]}" alt="${prod.name}">
          <div class="cart-item-details">
            <div class="cart-item-title">${prod.name}</div>
            <div class="cart-item-desc">${prod.desc}</div>
            <div class="cart-item-price">${prod.priceNew} ر.س × ${item.qty}</div>
          </div>
          <button class="cart-remove-btn" title="حذف المنتج" onclick="confirmRemoveCart(${prod.id})">&times;</button>
        `;
        list.appendChild(div);
      });
    }

    // ========== تأكيد حذف من السلة ==========
    function confirmRemoveCart(pid){
      if(confirm("هل أنت متأكد من حذف المنتج من السلة؟")){
        removeFromCart(pid);
      }
    }

    // ========== مؤثر عند الإضافة للسلة ==========
    function showAddToCartEffect(){
      const btn = document.getElementById('cart-btn');
      btn.animate([
        {transform:'scale(1.0)'},{transform:'scale(1.15)'},{transform:'scale(1.0)'}
      ],{duration:350});
    }

    // لجعل بعض الدوال متاحة للإيفنتات
    window.openProductModal = openProductModal;
    window.addToCart = addToCart;
    window.openCartModal = openCartModal;
    window.closeSidemenu = closeSidemenu;
    window.confirmRemoveCart = confirmRemoveCart;
  </script>
</body>
</html>